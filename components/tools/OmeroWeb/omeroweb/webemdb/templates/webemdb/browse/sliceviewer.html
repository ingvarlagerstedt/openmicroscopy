{% extends "webgateway/omero_image.html" %}
{% comment %}
<!--
  Copyright (C) 2011 University of Dundee & Open Microscopy Environment.
  All rights reserved.

  This program is free software: you can redistribute it and/or modify
  it under the terms of the GNU Affero General Public License as
  published by the Free Software Foundation, either version 3 of the
  License, or (at your option) any later version.

  This program is distributed in the hope that it will be useful,
  but WITHOUT ANY WARRANTY; without even the implied warranty of
  MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
  GNU Affero General Public License for more details.

  You should have received a copy of the GNU Affero General Public License
  along with this program.  If not, see <http://www.gnu.org/licenses/>.
-->
{% endcomment %}

{% block extra_css %}
{{ block.super }}
  <link rel="stylesheet" href="/webemdb/static/webemdb/css/sliceviewer.css" type="text/css" media="all" />
{% endblock %}

{% block after_onload %}
// We can do some customizing as soon as the html has loaded...
// Override function to avoid bright red background color.
  function syncRDCW() {
    var cb;
    var channels = viewport.getChannels();
    for (i in channels) {
      $('#rd-wblitz-ch'+i).get(0).checked = channels[i].active;
      $('#wblitz-ch'+i+'-cwslider .ui-slider-range').css('background-color', '#A0A0A0');
      $('#wblitz-ch'+i+'-color').css('background-color', toRGB(channels[i].color));
      $('#wblitz-ch'+i+'-cw-start').val(channels[i].window.start).change();
      $('#wblitz-ch'+i+'-cw-end').val(channels[i].window.end).change();
    }
    hidePicker();
    $('#rdef-undo-btn').attr('disabled',viewport.has_channels_undo()?'':'true');
    $('#rdef-redo-btn').attr('disabled',viewport.has_channels_redo()?'':'true');
    //$('#rdef-default-btn').attr('disabled',viewport.has_channels_undo()?'':'true');
    $('#rd-wblitz-rmodel').attr('checked', !viewport.isGreyModel());
  }
{% comment %}
- skipping the logo, as we go for an iframe solution instead
// Add logo to the top left
var logo = "<img style='padding:10px' src='{% url webemdb 'images/ebi.png' %}' />";
$('#wblitz-workarea').prepend(logo);
{% endcomment %}

// 'Render as Color' option
$('#rdef-active-area [for="rd-wblitz-rmodel"]').hide();
$('#rd-wblitz-rmodel').hide();
$('#rdef-postit-help').hide();

$('#wblitz-image-author').parent().hide();
$('#wblitz-image-t-count').parent().parent().hide();

$('div.multiselect:last').hide();  // hide 'split-view' option

$('#wblitz-channels-box').hide();  // channel toggle buttons

$('#wblitz-rmodel').parent().hide();  // color toggle

var rendering = $('label[for="wblitz-channels-box"]').parent();
var editLink = rendering.children('a');
rendering.html('');
rendering.append(editLink);
editLink.text("Edit Rendering");

// remove T: 1/1 display
$('#wblitz-t-curr-display').hide();

$('#roi_controls').hide();

$('#imageViewLink').hide();

{% endblock after_onload %}



{% block after_callback %}
// ...more edits AFTER image info has been used to create rendering controls etc. 

tmp = viewport.getPixelSizes();
$('#wblitz-image-pixel-size-x').html(tmp.x==0?'-':(tmp.x.toFixed(4) + ' Angstroms'));
$('#wblitz-image-pixel-size-y').html(tmp.y==0?'-':(tmp.y.toFixed(4) + ' Angstroms'));
$('#wblitz-image-pixel-size-z').html(tmp.z==0?'-':(tmp.z.toFixed(4) + ' Angstroms'));

// hide the channel toggle, colour picker etc. from rdef-postit
$('#rdef-postit table tr').hide()
$('#rdef-postit table tr.rdef-window').show();

$('#wblitz-rmodel').parent().hide();  // color toggle - hide again in case it got shown
{% comment %}
<td id="z-count-label"><span id="wblitz-image-z-count"></span></td>
$('#z-count-label').html('px');
{% endcomment %}
iSize = viewport.getSizes();
$('#z-count-label').html(iSize.z+'px');
$('#imageViewLink').hide();

{% endblock after_callback %}

